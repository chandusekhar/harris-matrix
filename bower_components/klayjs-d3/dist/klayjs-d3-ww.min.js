/*! klayjs-d3 version 0.3.2 build 201503261103*/
var klay;!function(a){function b(a){function b(a){var b=m/a.width||1,c=n/a.height||1;b>c&&(b=c),d&&d.attr("transform","scale("+b+")")}var d,e={},f=d3.dispatch("finish"),g=[],h=[],i={},j=function(a){return a.ports||[]},k=function(a){return a.labels||[]},l={},m=0,n=0,o=[10,10],p=[4,4],q=["x","y","width","height","sourcePoint","targetPoint","properties"].reduce(function(a,b){return a[b]=1,a},{}),r=function(){},s={};if("undefined"==typeof window||"function"!=typeof window.Worker)return window.alert("WebWorker not supported by browser."),{};var t=new Worker(c+"/klayjs-worker.js"),s={layout:function(a){t.postMessage({graph:a.graph,options:a.options})}};if(t.addEventListener("message",function(a){i=a.data,r(i)},!1),e.size=function(a){return arguments.length?(m=a[0],n=a[1],e):[m,n]},e.transformGroup=function(a){return arguments.length?(d=a,e):d},e.options=function(a){return arguments.length?(l=a,e):l},"adapter"===a){e.nodes=function(a){return arguments.length?(g=a,e):g},e.ports=function(a){return arguments.length?(j=a,e):j},e.links=function(a){return arguments.length?(h=a,e):h},e.defaultNodeSize=function(a){return arguments.length?(o=a,e):o},e.defaultPortSize=function(a){return arguments.length?(p=a,e):p},e.start=function(){return g.forEach(function(a,b){a.width=a.width||o[0],a.height=a.height||o[1],a.id=""+(a.id||b),a.ports=j(a),a.ports.forEach(function(a){a.width=a.width||p[0],a.height=a.height||p[1]}),a.labels=k(a)}),h.forEach(function(a,b){a.id=""+(a.id||b+g.length),a.source=""+a.source,a.target=""+a.target}),r=u,s.layout({graph:{id:"root",children:g,edges:h},options:l,success:function(a){i=a,r(a)},error:function(a){console.error(a)}}),e};var u=function(a){function c(a,b,c){var d=q;c&&(d=c.reduce(function(a,b){return a[b]=1,a},{}));for(var e in a)d[e]&&(b[e]=a[e])}a&&(b(a),a.children.forEach(function(a){var b=g[parseInt(a.id)];c(a,b),(a.ports||[]).forEach(function(a,d){c(a,b.ports[d])}),(a.labels||[]).forEach(function(a,d){c(a,b.labels[d])})}),a.edges.forEach(function(a){var b=h[parseInt(a.id)-g.length];c(a,b),c(a.source,b.source),c(a.target,b.target),b.bendPoints=a.bendPoints||[]})),f.finish({graph:a})}}if("kgraph"===a){e.nodes=function(){for(var a,b=[i],c=[];null!=(a=b.pop());)c.push(a),(a.children||[]).forEach(function(a){b.push(a)});return c},e.links=function(a){return d3.merge(a.map(function(a){return a.edges||[]}))},e.kgraph=function(a){return r=v,s.layout({graph:a,options:l,success:function(a){i=a,r(a)},error:function(a){console.error(a)}}),e};var v=function(a){b(a);var c={};w(a,{x:0,y:0},c),x(a,c),f.finish({graph:a})},w=function(a,b,c){a.x=(a.x||0)+b.x,a.y=(a.y||0)+b.y,c[a.id]=a,(a.children||[]).forEach(function(b){b.parent=a,w(b,{x:a.x,y:a.y},c)})},x=function(a,b){(a.edges||[]).forEach(function(a){var c=b[a.source].parent||{};a.sourcePoint&&(a.sourcePoint.x+=c.x||0,a.sourcePoint.y+=c.y||0),a.targetPoint&&(a.targetPoint.x+=c.x||0,a.targetPoint.y+=c.y||0),(a.bendPoints||[]).map(function(a){return{x:a.x+(c.x||0),y:a.y+(c.y||0)}})}),(a.children||[]).forEach(function(a){x(a,b)})}}return d3.rebind(e,f,"on")}a.d3adapter=function(){return b("adapter")},a.d3kgraph=function(){return b("kgraph")};var c;return c=function(){var a=document.getElementsByTagName("script");a=a[a.length-1];var b=a.src,c=b.substr(0,b.lastIndexOf("/")+1);return c}(),"object"==typeof module&&module.exports&&(module.exports=a),a}(klay||(klay={}));